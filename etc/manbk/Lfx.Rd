\name{Lfx}
\alias{Lfx}
\alias{M}
\alias{M.default}
\alias{M.factor}
\alias{M.formula}
\alias{M.M}
\alias{<.factor}
\alias{>.factor}
\alias{<=.factor}
\alias{=>.factor}
%- Also NEED an '\alias' for EACH other topic documented here.
\title{
Hypothesis matrix generated by expressions for each column or term
%%  ~~function to do ... ~~
}
\description{
Creates an L matrix using expressions evaluated in \code{data} for
each column or multi-column term of the L matrix
%%  ~~ A concise (1-5 lines) description of what the function does. ~~
}
\usage{
Lfx(fit, expr.list, data = getData(fit), wrap = FALSE, debug = FALSE)

Lfx(fit)

M(formula)

M(expr)

M.factor(fac)

fac1 < fac2

}
%- maybe also 'usage' for other objects documented here.
\arguments{
  \item{fit}{
    a fitted model with a 'getFix' method.
%%     ~~Describe \code{fit} here~~
}
  \item{expr.list}{
   a list of expressions with one component for each column (or groups of columns) of the hypothesis matrix corresponding to each term of the model. A term with multiple degrees of freedom can either be generated as separate single terms or with an expression that evaluates to a suitable matrix. 
%%     ~~Describe \code{expr.list} here~~
}
  \item{data}{
    the data frame in which expressions are evaluated.
%%     ~~Describe \code{data} here~~
}
  \item{wrap}{
  
%%     ~~Describe \code{wrap} here~~
}
  \item{debug}{
%%     ~~Describe \code{debug} here~~
}
  \item{formula}{
  as an argument of \code{M}, a one-sided formula defining a main effect or an interaction term involving factors.
  }
  \item{expr}{
  as an argument of \code{M}, an expression that can be evaluated in each row of \code{data} to form element(s) of the corresponding row of \code{L}.  formula defining a main effect or an interaction term involving factors.  
  }

}
\details{
%%  ~~ If necessary, more details than the description above ~~
}
\value{
%%  ~Describe the value returned
%%  If it is a LIST, use
%%  \item{comp1 }{Description of 'comp1'}
%%  \item{comp2 }{Description of 'comp2'}
%% ...
}
\references{
%% ~put references to the literature/web site here ~
}
\author{
%%  ~~who you are~~
}
\note{
%%  ~~further notes~~
}

%% ~Make other sections like Warning with \section{Warning }{....} ~

\seealso{
%% ~~objects to See Also as \code{\link{help}}, ~~~
}
\examples{
##
## The estimated effect of an additional year of education
##

data(Prestige)   # from car
fit <- lm( income ~ (education+I(education^2)) * type, Prestige)
summary(fit)
Lfx(fit)  # geneates expression to cut and paste and differentiate

pred <- expand.grid( education = 3:16, type = levels(Prestige$type))

Lf.ed <- Lfx( fit, 
              list( 0,
                    1 + 0* education,
                    2 * M(I(education)),
                    0 * M(type),
                    1 * 1 * M(type),
                    2 * M(I(education)) * M(type) 
              ),pred)
zw <- as.data.frame(wald(fit,Lf.ed))
head(zw)
xyplot( coef ~ education , zw, groups = type, type = 'l', auto.key = T)

fit2 <- lm( income ~ (education+I(education^2)) * type*women, Prestige)
pred <- expand.grid( education = 3:16, type = levels(Prestige$type), women=c(0,50,100))
Lfx(fit2)
zw <- Lfx(fit2,
    list( 0,   # differentiated wrt education
          1 * 1,
          1 * M(I(education)),
          0 * M(type),
          0 * women,
          1 * 1 * M(type),
          2 * M(I(education)) * M(type),
          1 * 1 * women,
          2 * M(I(education)) * women,
          0 * M(type) * women,
          1 * 1 * M(type) * women,
          2 * M(I(education)) * M(type) * women 
    ),pred)
zw    
zw <- as.data.frame( wald(fit2, zw))
summary(fit2)
xyplot( coef ~ education|women , zw, groups = type, type = 'l', auto.key = T,
        ylim = c(-30000,30000))

###
###  Differencing of factor
###

pred <- expand.grid( education = 3:18, women = c(0,50,100), 
                     type = levels(Prestige$type),
                     type0 = levels(Prestige$type))

Lfx(fit2)

Lcomp <- Lfx(fit2,
  list( 0,
      0 * education,
      0 * M(I(education^2)),
      1 * M(type) - M(type0),
      0 * women,
      1 * education * (M(type)-M(type0)),
      1 * M(I(education^2)) * (M(type) - M(type0)),
      0 * education * women,
      0 * M(I(education^2)) * women,
      1 * (M(type)-M(type0)) * women,
      1 * education * (M(type) - M(type0)) * women,
      1 * M(I(education^2)) * (M(type) - M(type0)) * women 
  ), pred)

zw <- as.data.frame( wald( fit2, Lcomp))
zw





}
% Add one or more standard keywords, see file 'KEYWORDS' in the
% R documentation directory.
\keyword{ ~kwd1 }
\keyword{ ~kwd2 }% __ONLY ONE__ keyword per line
